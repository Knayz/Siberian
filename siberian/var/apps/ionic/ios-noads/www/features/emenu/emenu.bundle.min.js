angular.module('starter').controller('EmenuSliderController',function(Dialog,Loader,Application,$ionicPopup,$cordovaCamera,Customer,Modal,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate,$controller,$ionicActionSheet){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.is_logged_in=Customer.isLoggedIn();$scope.restaurant=Emenu.getRestaurantInfo();$scope.shop_id=Emenu.shop_id=$scope.restaurant.id;$scope.slider={shop_id:$scope.shop_id,image:null,name:'',};$scope.loadSlider=function(){Loader.show();$scope.is_loading=!0;Emenu.loadSlider($scope.shop_id).success(function(data){$scope.slider_data=data.slider},function(error){$scope.is_loading=!1;Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).then(function(){$scope.is_loading=!1;Loader.hide()})};$scope.loadSlider();$scope.addSlider=function(){Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/add_slider.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.addSliderModal=modal;$scope.addSliderModal.show()})};$scope.closeAddSliderModal=function(){$scope.addSliderModal.remove();$scope.loadSlider()}
$scope.removeImage=function(){$scope.slider.image=null};$scope.addPicture=function(){var gotImage=function(image_url){$scope.imageToSend=image_url;$ionicPopup.show({template:'<center><img ng-src="{{imageToSend}}" style="max-width: 100%; max-height: 100%;"></center>',cssClass:'classifieds no-title',scope:$scope,buttons:[{text:$translate.instant("Cancel","emenu"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant("OK","emenu"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){$scope.slider.image=image_url}}).finally(function(){$scope.imageToSend=null})};var gotError=function(err){};if(Application.is_webview){var input=angular.element("<input type='file' accept='image/*'>");var selectedFile=function(evt){var file=evt.currentTarget.files[0];var reader=new FileReader();reader.onload=function(evt){gotImage(evt.target.result);input.off("change",selectedFile)};reader.onerror=gotError;reader.readAsDataURL(file)};input.on("change",selectedFile);input[0].click()}else{var source_type=Camera.PictureSourceType.CAMERA;var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant("Take a picture","emenu")},{text:$translate.instant("Import from Library","emenu")}],cancelText:$translate.instant("Cancel","emenu"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){source_type=Camera.PictureSourceType.CAMERA}
if(index==1){source_type=Camera.PictureSourceType.PHOTOLIBRARY}
var options={quality:90,destinationType:Camera.DestinationType.DATA_URL,sourceType:source_type,encodingType:Camera.EncodingType.JPEG,targetWidth:800,targetHeight:800,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){gotImage("data:image/jpeg;base64,"+imageData)},gotError);return!0}})}};$scope.sliderSave=function(){Loader.show();Emenu.sliderSave($scope.slider).success(function(data){Loader.hide();Dialog.alert('Success',data.message,'Ok',-1,"emenu");$scope.slider={shop_id:$scope.shop_id,image:null,name:''};$scope.loadSlider();$scope.closeAddSliderModal()}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,"emenu")})};$scope.item_image=function(image){if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/application'+image}else{return'./features/emenu/assets/media/default-image.png'}};$scope.sliderMenu=function(slider){var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant("Disable","emenu")},{text:$translate.instant("Edit","emenu")},{text:$translate.instant("Delete","emenu")}],cancelText:$translate.instant("Cancel","emenu"),cancel:function(){hideSheet()},buttonClicked:function(index){return!0}})}});angular.module('starter').controller('EmenuCategoryController',function(Dialog,Loader,Application,$ionicPopup,$cordovaCamera,Customer,Modal,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate,$filter,$controller,$ionicActionSheet){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.restaurant=Emenu.getRestaurantInfo();$scope.shop_id=Emenu.shop_id=$scope.restaurant.id;$scope.is_loading=!1;$scope.is_logged_in=Customer.isLoggedIn();$scope.is_new_Image=!1;$scope.aclPermission=Emenu.getPermissions();$scope.category={shop_id:$scope.shop_id,image:null,category_name:''};$scope.addCategory=function(){$scope.category={shop_id:$scope.shop_id,image:null,category_name:''};Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/add_category.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.addCategoryModal=modal;$scope.addCategoryModal.show()})};$scope.closeAddCategoryModal=function(){$scope.addCategoryModal.remove()}
$scope.editCategory=function(category){$scope.category=category;Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/edit_category.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.editCategoryModal=modal;$scope.editCategoryModal.show()})};$scope.closeEditCategoryModal=function(){$scope.editCategoryModal.remove()}
$scope.loadContent=function(){$scope.is_new_Image=!1;Loader.show();$scope.is_loading=!0;Emenu.loadCategory($scope.shop_id).success(function(data){$scope.categories=data.category},function(error){$scope.is_loading=!1;Loader.hide();Dialog.alert($translate.instant("Error","emenu"),error.message,$translate.instant("Ok","emenu"),-1,'emenu')}).then(function(){$scope.is_loading=!1;Loader.hide()})};$scope.loadContent();$scope.addPicture=function(){var gotImage=function(image_url){$scope.imageToSend=image_url;$ionicPopup.show({template:'<center><img ng-src="{{imageToSend}}" style="max-width: 100%; max-height: 100%;"></center>',cssClass:'classifieds no-title',scope:$scope,buttons:[{text:$translate.instant("Cancel","emenu"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant("OK","emenu"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){$scope.is_new_Image=!0;$scope.category.image=image_url}}).finally(function(){$scope.imageToSend=null})};var gotError=function(err){};if(Application.is_webview){var input=angular.element("<input type='file' accept='image/*'>");var selectedFile=function(evt){var file=evt.currentTarget.files[0];var reader=new FileReader();reader.onload=function(evt){gotImage(evt.target.result);input.off("change",selectedFile)};reader.onerror=gotError;reader.readAsDataURL(file)};input.on("change",selectedFile);input[0].click()}else{var source_type=Camera.PictureSourceType.CAMERA;var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant("Take a picture","emenu")},{text:$translate.instant("Import from Library","emenu")}],cancelText:$translate.instant("Cancel","emenu"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){source_type=Camera.PictureSourceType.CAMERA}
if(index==1){source_type=Camera.PictureSourceType.PHOTOLIBRARY}
var options={quality:50,destinationType:Camera.DestinationType.DATA_URL,sourceType:source_type,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){gotImage("data:image/jpeg;base64,"+imageData)},gotError);return!0}})}};$scope.removeImage=function(){$scope.category.image=null};$scope.category_image=function(image){if($scope.is_new_Image){return image}
if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/application'+image}else{return"./features/emenu/assets/media/default-image.png"}};$scope.categorySave=function(type){Loader.show();Emenu.categorySave($scope.category).success(function(data){$scope.is_new_Image=!1;Loader.hide();Dialog.alert('Success',data.message,'Ok',-1,'emenu');if(type==1){$scope.loadContent();$scope.closeAddCategoryModal()}else{$scope.category={shop_id:$scope.shop_id,image:null,category_name:''};$scope.loadContent()}}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,'emenu')})};$scope.categoryUpdate=function(){Loader.show();Emenu.categorySave($scope.category).success(function(data){$scope.is_new_Image=!1;Loader.hide();Dialog.alert('Success',data.message,'Ok',-1,'emenu');$scope.loadContent();$scope.closeEditCategoryModal()}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,'emenu')})};$scope.updateStatusCategory=function(category,status){var title=(status==2)?$translate.instant("Delete","emenu"):$translate.instant("Status","emenu");var template=(status==2)?$translate.instant('Are you sure want to delete?',"emenu"):$translate.instant('Are you sure want to change status?',"emenu");$ionicPopup.show({title:title,template:template,cssClass:'category-status',scope:$scope,buttons:[{text:$translate.instant('Cancel',"emenu"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK',"emenu"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){if(status!=2){if(category.is_active==1){category.status=0}else{category.status=1}}
if(status==2){category.status=2}
Loader.show();Emenu.updateStatusCategory(category).success(function(data){Loader.hide();Dialog.alert('Success',data.message,'Ok',-1,"emenu");$scope.loadContent()}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,"emenu")})}})};$scope.categoryMenu=function(category){var enable_disable=(category.is_active==1)?$translate.instant("Disable","emenu"):$translate.instant("Enable","emenu");var hideSheet=$ionicActionSheet.show({buttons:[{text:enable_disable},{text:$translate.instant("Edit","emenu")},{text:$translate.instant("Delete","emenu")}],cancelText:$translate.instant("Cancel","emenu"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){$scope.updateStatusCategory(category,1)}
if(index==1){$scope.editCategory(category)}
if(index==2){$scope.updateStatusCategory(category,2)}
return!0}})};$scope.aclAccessCheck=function(code){if($scope.aclPermission!=null&&$scope.aclPermission.length>0){var accessType=$filter('filter')($scope.aclPermission,{key:code});if(accessType[0].status==!0){return!0}else{return!1}}
return!0}});angular.module('starter').controller('EmenuItemController',function(Dialog,$timeout,$ionicScrollDelegate,Loader,Application,$ionicPopup,$cordovaCamera,Customer,Modal,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate,$controller,$ionicActionSheet,$filter){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.collection_items=[];$scope.filterValues={};$scope.shop=Emenu.getRestaurantInfo();$scope.aclPermission=Emenu.getPermissions();$scope.shop_id=Emenu.shop_id=$scope.shop.id;$scope.categories=[];$scope.can_load_older_posts_items=!0;$scope.is_new_Image=!1;$scope.is_filter_apply=!1;var keyupTimer;$scope.searchObj={searchText:''};$scope.item={shop_id:$scope.shop_id,image:null,name:'',price:''};$scope.$on("$ionicView.beforeEnter",function(event,data){Emenu.setItemFilter({})});$scope.isUndefined=function(thing){return(typeof thing==='undefined')};$scope.loadContent=function(){if(!$scope.isUndefined(Emenu.getItemFilter())){$scope.filterValues=Emenu.getItemFilter()}
$scope.collection_items=[];$scope.is_new_Image=!1;$scope.is_loading=!0;Emenu.loadItems($scope.shop_id,$scope.collection_items.length,$scope.filterValues).success(function(data){$scope.can_load_older_posts_items=!!data.items.length;$scope.collection_items=$scope.collection_items.concat(data.items);$scope.categories=data.categories;$scope.is_loading=!1;Loader.hide();$rootScope.$broadcast('refreshPageSize')}).error(function(error){$scope.is_loading=!1;$scope.can_load_older_posts_items=!1;Dialog.alert('Error',error.message,'OK',-1,'emenu')}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.loadContent();$scope.loadMoreItem=function(){if(!$scope.collection_items.length){return!1}
Emenu.loadItems($scope.shop_id,$scope.collection_items.length,$scope.filterValues).success(function(data){$scope.can_load_older_posts_items=!!data.items.length;$scope.collection_items=$scope.collection_items.concat(data.items);$rootScope.$broadcast('refreshPageSize')}).error(function(error){$scope.can_load_older_posts=!1;Dialog.alert('Error',error.message,'OK',-1,'emenu')}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.addItem=function(){$scope.item={shop_id:$scope.shop_id,image:null,name:'',price:''};Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/add_item.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.categories=$scope.categories;$scope.addItemModal=modal;$scope.addItemModal.show()})};$scope.closeAddItemModal=function(){$scope.addItemModal.remove()}
$scope.removeImage=function(){$scope.item.image=null};$scope.addPicture=function(){var gotImage=function(image_url){$scope.imageToSend=image_url;$ionicPopup.show({template:'<center><img ng-src="{{imageToSend}}" style="max-width: 100%; max-height: 100%;"></center>',cssClass:'classifieds no-title',scope:$scope,buttons:[{text:$translate.instant("Cancel","emenu"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant("OK","emenu"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){$scope.is_new_Image=!0;$scope.item.image=image_url}}).finally(function(){$scope.imageToSend=null})};var gotError=function(err){};if(Application.is_webview){var input=angular.element("<input type='file' accept='image/*'>");var selectedFile=function(evt){var file=evt.currentTarget.files[0];var reader=new FileReader();reader.onload=function(evt){gotImage(evt.target.result);input.off("change",selectedFile)};reader.onerror=gotError;reader.readAsDataURL(file)};input.on("change",selectedFile);input[0].click()}else{var source_type=Camera.PictureSourceType.CAMERA;var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant("Take a picture","emenu")},{text:$translate.instant("Import from Library","emenu")}],cancelText:$translate.instant("Cancel","emenu"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){source_type=Camera.PictureSourceType.CAMERA}
if(index==1){source_type=Camera.PictureSourceType.PHOTOLIBRARY}
var options={quality:90,destinationType:Camera.DestinationType.DATA_URL,sourceType:source_type,encodingType:Camera.EncodingType.JPEG,targetWidth:800,targetHeight:800,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){gotImage("data:image/jpeg;base64,"+imageData)},gotError);return!0}})}};$scope.item_image=function(image){if($scope.is_new_Image){return image}
if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/application'+image}else{return'./features/emenu/assets/media/default-image.png'}};$scope.itemSave=function(type){Loader.show();Emenu.itemSave($scope.item).success(function(data){$scope.is_new_Image=!1;Dialog.alert('Success',data.message,'Ok',-1,"emenu");if(type==1){$scope.closeAddItemModal()}else{$scope.item={shop_id:$scope.shop_id,image:null,name:'',price:''}}
$timeout(function(){$scope.loadContent();Loader.hide()},1000)}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,"emenu")})};$scope.updateStatusItem=function(item,status){var title=(status==2)?$translate.instant("Delete","emenu"):$translate.instant("Status","emenu");var template=(status==2)?$translate.instant('Are you sure want to delete?',"emenu"):$translate.instant('Are you sure want to change status?',"emenu");$ionicPopup.show({title:title,template:template,cssClass:'item-status',scope:$scope,buttons:[{text:$translate.instant('Cancel',"emenu"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK',"emenu"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){if(status!=2){if(item.is_active==1){item.status=0}else{item.status=1}}
if(status==2){item.status=2}
Loader.show();Emenu.updateStatusItem(item).success(function(data){Loader.hide();Dialog.alert('Success',data.message,'Ok',-1,"emenu");$scope.loadContent()}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,"emenu")})}})};$scope.markUpdateItem=function(item,action){item.action=action;Loader.show();Emenu.markUpdateItem(item).success(function(data){Loader.hide();Dialog.alert('Success',data.message,'Ok',-1,"emenu");$scope.loadContent()}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,"emenu")})};$scope.itemMenuSheet=function(item){var enable_disable=(item.is_active==1)?$translate.instant("Disable","emenu"):$translate.instant("Enable","emenu");var special_button=(item.is_special==1)?$translate.instant("UnMark as Special","emenu"):$translate.instant("Mark as Special","emenu");var popular_button=(item.is_popular==1)?$translate.instant("UnMark as Popular","emenu"):$translate.instant("Mark as Popular","emenu");var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant(special_button,"emenu")},{text:$translate.instant(popular_button,"emenu")},{text:$translate.instant(enable_disable,"emenu")},{text:$translate.instant("Edit","emenu")},{text:$translate.instant("Delete","emenu")}],cancelText:$translate.instant("Cancel","emenu"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){$scope.markUpdateItem(item,'special')}
if(index==1){$scope.markUpdateItem(item,'popular')}
if(index==3){$scope.editItem(item)}
if(index==2){$scope.updateStatusItem(item,1)}
if(index==4){$scope.updateStatusItem(item,2)}
return!0}})}
$scope.editItem=function(item){$scope.item={};Loader.show();Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/edit_item.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.categories=$scope.categories;$scope.item=item;$scope.item.shop_id=$scope.shop_id;$scope.item.category_id=item.category_id;$scope.editItemModal=modal;$scope.editItemModal.show();Loader.hide()})};$scope.closeEditItemModal=function(){$scope.editItemModal.remove()};$scope.itemUpdate=function(){Loader.show();Emenu.itemSave($scope.item).success(function(data){$scope.is_new_Image=!1;Dialog.alert('Success',data.message,'Ok',-1,"emenu");$scope.closeEditItemModal();$timeout(function(){$scope.loadContent();Loader.hide()},1000)}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,"emenu")})};$scope.itemFilterMenu=function(){Loader.show();Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/filter_menu.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.categories=$scope.categories;if(!$scope.isUndefined(Emenu.getItemFilter())){$scope.filterValues=Emenu.getItemFilter()}else{$scope.filterValues={};Emenu.setItemFilter({})}
$scope.itemFilterMenuModal=modal;$scope.itemFilterMenuModal.show();Loader.hide()})};$scope.closeItemFilterMenuModal=function(){$scope.itemFilterMenuModal.remove()};$scope.applyItemFilter=function(filterValues){var isObjectEmpty=!Object.keys($scope.filterValues).length;if(isObjectEmpty){Dialog.alert('Error','Please select at least 1 option for filter item.',"OK",-1,"emenu");return!1}
$scope.is_filter_apply=!0;$scope.closeItemFilterMenuModal();Emenu.setItemFilter($scope.filterValues);$ionicScrollDelegate.scrollTop(!0);$timeout(function(){$scope.loadContent();Loader.hide()},1000)};$scope.clearAllItemFilter=function(){$scope.is_filter_apply=!1;$scope.closeItemFilterMenuModal();Emenu.setItemFilter({});$ionicScrollDelegate.scrollTop(!0);$timeout(function(){$scope.loadContent();Loader.hide()},1000)};$scope.aclAccessCheck=function(code){if($scope.aclPermission!=null&&$scope.aclPermission.length>0){var accessType=$filter('filter')($scope.aclPermission,{key:code});if(accessType[0].status==!0){return!0}else{return!1}}
return!0}});angular.module('starter').controller('EmenuQrCodeController',function($scope,$stateParams,Dialog,SocialSharing,Application,Emenu){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.shop=Emenu.getRestaurantInfo();$scope.shop_id=Emenu.shop_id=$scope.shop.id;$scope.page_title='QR Code';$scope.payout={};$scope.generateqrCode=function(){return Emenu.getQRCode($scope.shop_id)};$scope.shareQrCode=function(){if(!Application.is_webview){return window.plugins.socialsharing.share(null,null,null,$scope.shop.url)}else{Dialog.alert("Error",'Not working in overview',"OK",-1,"emenu")}}});angular.module('starter').controller('EmenuSpecialPopularController',function(Dialog,$timeout,$ionicScrollDelegate,Loader,Application,$ionicPopup,$cordovaCamera,Customer,Modal,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.action=$stateParams.action;$scope.is_loading=!1;$scope.collection_items=[];$scope.shop=Emenu.getRestaurantInfo();$scope.shop_id=Emenu.shop_id=$scope.shop.id;$scope.page_title='Items';if($scope.action==='special'){$scope.page_title=$translate.instant("Special Item","emenu")}
if($scope.action==='popular'){$scope.page_title=$translate.instant("Popular Item","emenu")}
$scope.loadContent=function(){$scope.is_loading=!0;Emenu.loadSpecialPopularItems($scope.shop_id,$scope.action).success(function(data){$scope.collection_items=data.items;$scope.is_loading=!1;Loader.hide()}).error(function(error){$scope.is_loading=!1;Dialog.alert('Error',error.message,"OK",-1,"emenu")}).finally(function(){})};$scope.loadContent();$scope.item_image=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/application'+image}else{return"./features/emenu/assets/media/default-image.png"}};$scope.markUpdateItem=function(item){item.action=$scope.action;Loader.show();Emenu.markUpdateItem(item).success(function(data){Loader.hide();Dialog.alert('Success',data.message,'Ok',-1,"emenu");$scope.loadContent()}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,"emenu")})};$scope.removeAction=function(item){var title=$translate.instant("Remove","emenu");var template=$translate.instant('Are you sure want to remove?',"emenu");$ionicPopup.show({title:title,template:template,cssClass:'item-status',scope:$scope,buttons:[{text:$translate.instant('Cancel',"emenu"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK',"emenu"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){$scope.markUpdateItem(item)}})}});angular.module('starter').controller('EmenuShopController',function(Dialog,Loader,Application,$ionicPopup,Customer,Modal,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate,$controller,$cordovaCamera,$ionicActionSheet){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.is_logged_in=Customer.isLoggedIn();$scope.is_new_Image=!1;if(Emenu.getRestaurantInfo().length==0){$scope.restaurant={latitude:'',longitude:'',location:'',logo:''}}else{$scope.restaurant=Emenu.getRestaurantInfo()}
$scope.addLogo=function(){var gotImage=function(image_url){$scope.imageToSend=image_url;$ionicPopup.show({template:'<center><img ng-src="{{imageToSend}}" style="max-width: 100%; max-height: 100%;"></center>',cssClass:'classifieds no-title',scope:$scope,buttons:[{text:$translate.instant("Cancel","emenu"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant("OK","emenu"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){$scope.is_new_Image=!0;$scope.restaurant.logo=image_url}}).finally(function(){$scope.imageToSend=null})};var gotError=function(err){};if(Application.is_webview){var input=angular.element("<input type='file' accept='image/*'>");var selectedFile=function(evt){var file=evt.currentTarget.files[0];var reader=new FileReader();reader.onload=function(evt){gotImage(evt.target.result);input.off("change",selectedFile)};reader.onerror=gotError;reader.readAsDataURL(file)};input.on("change",selectedFile);input[0].click()}else{var source_type=Camera.PictureSourceType.CAMERA;var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant("Take a picture","emenu")},{text:$translate.instant("Import from Library","emenu")}],cancelText:$translate.instant("Cancel","emenu"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){source_type=Camera.PictureSourceType.CAMERA}
if(index==1){source_type=Camera.PictureSourceType.PHOTOLIBRARY}
var options={quality:90,destinationType:Camera.DestinationType.DATA_URL,sourceType:source_type,encodingType:Camera.EncodingType.JPEG,targetWidth:800,targetHeight:800,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){gotImage("data:image/jpeg;base64,"+imageData)},gotError);return!0}})}};$scope.removeImage=function(){$scope.restaurant.logo=''};$scope.disableTap=function(){var container=angular.element(document.getElementsByClassName('pac-container'));container.attr('data-tap-disabled','true');container.on("click",function(){document.getElementById('pac-input').blur()})};$scope.updateLoaction=function(){$scope.restaurant.latitude=$scope.restaurant.longitude=$scope.restaurant.location=null;if(_.isObject($scope.restaurant.place)){var loc=_.get($scope.restaurant,"place.geometry.location");if(loc){$scope.restaurant.latitude=loc.lat();$scope.restaurant.longitude=loc.lng();_.forEach(_.get($scope.restaurant.place,"address_components"),function(adco){console.log('adco',adco);if(_.includes(_.get(adco,"types")||[],"postal_code")){$scope.restaurant.zipcode=_.get(adco,"long_name")}
if(_.includes(_.get(adco,"types")||[],"locality")){$scope.restaurant.location=_.get(adco,"long_name")}})}}};$scope.saveRestaurant=function(restaurant){Loader.show();Emenu.saveRestaurant($scope.restaurant).success(function(data){Loader.hide();Dialog.alert('Success',data.message,'Ok',-1,'emenu');$state.go('home').then(function(){$state.go("emenu-home",{value_id:$scope.value_id},{reload:!0})})}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,"emenu")})};$scope.logo_image=function(image){if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/application'+image}else{return"./features/emenu/assets/media/default-image.png"}}});angular.module('starter').controller('EmenuCustomersController',function(Dialog,$timeout,SocialSharing,$ionicScrollDelegate,Loader,Application,$ionicPopup,$cordovaCamera,Customer,Modal,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.shop=Emenu.getRestaurantInfo();$scope.shop_id=Emenu.shop_id=$scope.shop.id;$scope.payout={customers:{}};$scope.can_load_older_items=!1;$scope.use_pull_refresh=!0;$scope.pull_to_refresh=!1;$scope.loadContent=function(pullToRefresh){$scope.payout.customers={};$scope.is_loading=!0;Emenu.shopCustomers(pullToRefresh,$scope.shop_id,$scope.payout.customers.length).then(function(data){$scope.can_load_older_items=!!data.customers.length;$scope.payout=data;$scope.is_loading=!1;if($scope.pull_to_refresh){$scope.$broadcast('scroll.refreshComplete');$scope.pull_to_refresh=!1}},function(error){$scope.is_loading=!1;Dialog.alert('Error',error.message,'OK',-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent(!1);$scope.pullToRefresh=function(){$scope.pull_to_refresh=!0;$scope.loadContent(!0)};$scope.loadMoreCustomers=function(){Emenu.shopCustomers(!1,$scope.shop_id,$scope.payout.customers.length).then(function(data){$scope.can_load_older_items=!!data.customers.length;$scope.payout.customers=$scope.payout.customers.concat(data.customers);$rootScope.$broadcast('refreshPageSize')},function(error){$scope.can_load_older_items=!1;Dialog.alert('Error',error.message,"OK",-1,"emenu")}).then(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.isMobileNumber=function(mobile_number){var constValue=mobile_number.substring(0,6);if(constValue=='000000'){return!1}
return!0}
$scope.customer_avatar=function(image){if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/customer'+image}
return'./features/emenu/assets/media/customer-placeholder.png'}});angular.module('starter').controller('EmenuHomeController',function(Dialog,Loader,Application,$ionicSideMenuDelegate,Customer,$filter,$session,Modal,$ionicScrollDelegate,$timeout,$ionicHistory,$rootScope,SB,Emenu,$scope,$state,$stateParams,EmenuInit){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.vendor_id=Emenu.vendor_id=$stateParams.vendor_id;$scope.is_refresh=$stateParams.is_refresh;$scope.is_browser=(window.location.href.indexOf('/apps/browser/')!==-1);$scope.is_loading=!0;$scope.is_browser_message=!1;$scope.is_logged_in=Customer.isLoggedIn();$scope.have_restaurant=!0;$scope.shop_id=0;$scope.payout={};$scope.collection_items=[];$scope.filterValues={};$scope.carts=[];$scope.user={name:'',phone_number:''};$scope.order={table_number:'',total_members:''};$scope.action={tab:'menu'};if($scope.is_browser){$session.getItem('emenu-last-vendor-id').then(function(parts){EmenuInit.loadVendor(parts)});$ionicSideMenuDelegate.canDragContent(!1);$ionicHistory.nextViewOptions({disableBack:!0});$timeout(function(){$scope.is_browser_message=!0},4000)}
$scope.isUndefined=function(thing){return(typeof thing==='undefined')};$scope.loadContent=function(){$scope.is_loading=!0;Emenu.findAll().then(function(data){$scope.payout=data;$scope.page_title=data.page_title;$scope.restaurant=data.shop;if(data.shop_id>0){$scope.page_title=data.shop.name;$scope.shop_id=Emenu.shop_id=data.shop_id;Emenu.setRestaurantInfo($scope.restaurant);Emenu.setPermissions($scope.payout.managerACL)}else{$scope.shop_id=0;Emenu.setRestaurantInfo([])}
$scope.is_loading=!1},function(error){$scope.is_loading=!1;Dialog.alert('Error',error.message,'OK',-1,'emenu')}).then(function(){$scope.is_loading=!1})};$rootScope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$timeout(function(){$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;if(Customer.isLoggedIn()){$scope.loadContent()}},1000)});$rootScope.$on(SB.EVENTS.AUTH.logoutSuccess,function(){$timeout(function(){$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;if(Customer.isLoggedIn()){$scope.loadContent()}},1000)});$scope.loginUser=function(){Loader.show();Emenu.loginUser($scope.user,$scope.vendor_id).then(function(data){$scope.loadContent();Loader.hide()},function(error){Loader.hide();Dialog.alert('Error',error.message,'OK',-1,'emenu')})};$scope.login=function(){Customer.loginModal($scope)};$scope.customer_avatar=function(image){if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/customer'+image}
return'./features/emenu/assets/media/customer-placeholder.png'};$scope.logo_image=function(image){if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/application'+image}
return'./features/emenu/assets/media/default-image.png'};$scope.item_image=function(image){if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/application'+image}
return'./features/emenu/assets/media/default-image.png'};$scope.homeItemFilterMenu=function(){Loader.show();Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/filter_menu.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.categories=$scope.categories;if(!$scope.isUndefined(Emenu.getItemFilter())){$scope.filterValues=Emenu.getItemFilter()}else{$scope.filterValues={};Emenu.setItemFilter({})}
$scope.itemFilterMenuModal=modal;$scope.itemFilterMenuModal.show();Loader.hide()})};$scope.closeItemFilterMenuModal=function(){$scope.itemFilterMenuModal.remove()};$scope.applyItemFilter=function(filterValues){var isObjectEmpty=!Object.keys($scope.filterValues).length;if(isObjectEmpty){Dialog.alert('Error','Please select at least 1 option for filter item.','OK',-1,'emenu');return!1}
$scope.closeItemFilterMenuModal();Emenu.setItemFilter($scope.filterValues);$ionicScrollDelegate.scrollTop(!0);$timeout(function(){$scope.loadVendorItems();Loader.hide()},1000)};$scope.clearAllItemFilter=function(){$scope.closeItemFilterMenuModal();Emenu.setItemFilter({});$scope.filterValues={};$ionicScrollDelegate.scrollTop(!0);$timeout(function(){$scope.loadVendorItems();Loader.hide()},1000)};$scope.convertDate=function(date){return $filter('moment_calendar')((new Date(date)).getTime())};$scope.isUndefined=function(thing){return(typeof thing==="undefined")}
$scope.aclAccessCheck=function(code){if($scope.payout.isAdmin){return!0}
if($scope.payout.isManager){var accessType=$filter('filter')($scope.payout.managerACL,{key:code});if(accessType.length>0&&accessType[0].status==!0){return!0}else{return!1}}
return!1};$scope.loadContent()});angular.module('starter').controller('EmenuHomeCustomerController',function(Dialog,Loader,Application,$ionicSideMenuDelegate,Customer,$filter,$session,Modal,$ionicScrollDelegate,$timeout,$ionicHistory,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate,$ionicActionSheet,$ionicPopup){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.vendor_id=Emenu.vendor_id=$stateParams.vendor_id;$scope.is_refresh=$stateParams.is_refresh;$scope.is_browser=!0;$scope.is_loading=!0;$scope.have_restaurant=!0;$scope.shop_id=0;$scope.payout={};$scope.collection_items=[];$scope.filterValues={};$scope.carts=[];$scope.vendorInfo=[];$scope.user={name:'',phone_number:''};$scope.order={table_number:'',total_members:''};$scope.action={tab:'menu'};$ionicSideMenuDelegate.canDragContent(!1);$scope.isUndefined=function(thing){return(typeof thing==='undefined')};$scope.reload=function(){if(!$scope.is_loading){if($scope.action.tab==='menu'){$scope.loadContent()}else{$scope.loadVendorItems(!0)}}};$scope.loadContent=function(){$scope.is_loading=!0;return Emenu.findAll().then(function(data){$scope.page_title=data.page_title;$scope.restaurant=data.shop;if(data.shop_id>0){$scope.page_title=data.shop.name;$scope.shop_id=Emenu.shop_id=data.shop_id;Emenu.setRestaurantInfo($scope.restaurant)}else{$scope.shop_id=0;Emenu.setRestaurantInfo([])}
$scope.is_loading=!1},function(error){$scope.is_loading=!1;Dialog.alert('Error',error.message,'OK',-1,'emenu')}).then(function(){$scope.is_loading=!1})};$scope.loadVendorItems=function(refresh){if(!$scope.isUndefined(Emenu.getItemFilter())){$scope.filterValues=Emenu.getItemFilter()}
$scope.collection_items=[];$scope.is_loading=!0;return Emenu.loadVendorItems($scope.vendor_id,$scope.collection_items.length,$scope.filterValues,refresh).then(function(data){$timeout(function(){$scope.can_load_older_posts_items=!!data.items.length;$scope.collection_items=$scope.collection_items.concat(data.items);$scope.categories=data.categories;$scope.page_title=data.vendor.name;$scope.payout=data;$scope.vendorInfo=data.vendor});Loader.hide();$rootScope.$broadcast('refreshPageSize')},function(error){$scope.can_load_older_posts_items=!1;Dialog.alert('Error',error.message,'OK',-1,'emenu')}).then(function(){$scope.is_loading=!1;$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.loadMoreVendorItems=function(){Emenu.loadVendorItems($scope.vendor_id,$scope.collection_items.length,$scope.filterValues).then(function(data){$scope.can_load_older_posts_items=!!data.items.length;$scope.collection_items=$scope.collection_items.concat(data.items);$rootScope.$broadcast('refreshPageSize')},function(error){$scope.can_load_older_posts_items=!1;Dialog.alert('Error',error.message,'OK',-1,'emenu')}).then(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.customer_avatar=function(image){if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/customer'+image}
return'./features/emenu/assets/media/customer-placeholder.png'};$scope.logo_image=function(image){if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/application'+image}
return'./features/emenu/assets/media/default-image.png'};$scope.item_image=function(image){if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/application'+image}
return'./features/emenu/assets/media/default-image.png'};$scope.loginUser=function(){Loader.show();Emenu.loginUser($scope.user,$scope.vendor_id).then(function(){$scope.loadContent();$scope.loadVendorItems(!0)},function(error){Dialog.alert('Error',error.message,'OK',-1,'emenu')}).then(function(){Loader.hide()})};$scope.login=function(){Customer.loginModal($scope)};$rootScope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$timeout(function(){$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;if(Customer.isLoggedIn()){$scope.loadContent();$scope.loadVendorItems(!0)}},1000)});$rootScope.$on(SB.EVENTS.AUTH.logoutSuccess,function(){$timeout(function(){$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;if(Customer.isLoggedIn()){$scope.loadContent();$scope.loadVendorItems(!0)}},1000)});$scope.getTotal=function(){return $scope.carts.reduce(function(total,item){return parseFloat(total+(item.price*item.quantity))},0)};$scope.getTaxAmount=function(){var total_amount=$scope.carts.reduce(function(total,item){return parseFloat(total+(item.price*item.quantity))},0);var tax_amount=((total_amount*$scope.vendorInfo.tax_percentage)/100);return parseFloat(tax_amount.toFixed(2))};$scope.getFinalTotal=function(){return parseFloat($scope.getTotal())+parseFloat($scope.getTaxAmount())}
$scope.quantity=function(value){var item=_.find($scope.carts,{'id':value.id});return item===undefined?0:item.quantity};$scope.isInList=function(value){var item=_.find($scope.carts,{'id':value.id});return item!==undefined};$scope.homeItemFilterMenu=function(){Loader.show();Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/filter_menu.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.categories=$scope.categories;if(!$scope.isUndefined(Emenu.getItemFilter())){$scope.filterValues=Emenu.getItemFilter()}else{$scope.filterValues={};Emenu.setItemFilter({})}
$scope.itemFilterMenuModal=modal;$scope.itemFilterMenuModal.show();Loader.hide()})};$scope.closeItemFilterMenuModal=function(){$scope.itemFilterMenuModal.remove()};$scope.placeOrder=function(delivery_type){Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/place_order.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.order.delivery_type=delivery_type;$scope.order.userId=$scope.payout.userId;$scope.order.vendor_id=$scope.vendor_id;$scope.order.products=$scope.carts;$scope.order.payment_method='';$scope.order.amount=$scope.getTotal();$scope.order.tax_amount=$scope.getTaxAmount();$scope.order.total_items=$scope.carts.reduce(function(total,item){return total+item.quantity},0);if($scope.order.delivery_type=='deliver'){$scope.order.delivery_charge=parseFloat($scope.vendorInfo.delivery_charge)}else{$scope.order.delivery_charge=parseFloat(0)}
$scope.order.total_amount=$scope.getFinalTotal()+$scope.order.delivery_charge;console.log('order',$scope.order);$scope.placeOrderModal=modal;$scope.placeOrderModal.show()})};$scope.closeplaceOrderModal=function(){return $scope.placeOrderModal.remove()};$scope.selectPaymentMethod=function(method){$scope.order.payment_method=method}
$scope.choiceDeliveryOptions=function(){var buttonIndexing=[];var buttonPositon=0;var sheetButtons=[];if($scope.vendorInfo.enable_pickup){sheetButtons[buttonPositon]={text:$translate.instant("Pick-Up","emenu")};buttonIndexing[buttonPositon]='pickup';buttonPositon=buttonPositon+1}
if($scope.vendorInfo.enable_delivery){sheetButtons[buttonPositon]={text:$translate.instant("Home Deliver","emenu")};buttonIndexing[buttonPositon]='deliver';buttonPositon=buttonPositon+1}
if($scope.vendorInfo.enable_dine_in){sheetButtons[buttonPositon]={text:$translate.instant("Dine-In","emenu")};buttonIndexing[buttonPositon]='dine-in';buttonPositon=buttonPositon+1}
if(sheetButtons.length==0){$scope.placeOrder(null);return!0}
if(sheetButtons.length==1){$scope.placeOrder(buttonIndexing[0]);return!0}
var hideSheet=$ionicActionSheet.show({buttons:sheetButtons,cancelText:$translate.instant("Cancel","emenu"),cancel:function(){hideSheet()},buttonClicked:function(index){$scope.placeOrder(buttonIndexing[index]);return!0}})}
$scope.applyItemFilter=function(filterValues){var isObjectEmpty=!Object.keys($scope.filterValues).length;if(isObjectEmpty){Dialog.alert('Error','Please select at least 1 option for filter item.','OK',-1,'emenu');return!1}
$scope.closeItemFilterMenuModal();Emenu.setItemFilter($scope.filterValues);$ionicScrollDelegate.scrollTop(!0);$timeout(function(){$scope.loadVendorItems(!0);Loader.hide()},1000)};$scope.clearAllItemFilter=function(){$scope.closeItemFilterMenuModal();Emenu.setItemFilter({});$scope.filterValues={};$ionicScrollDelegate.scrollTop(!0);$timeout(function(){$scope.loadVendorItems(!0);Loader.hide()},1000)};$scope.addInList=function(value){var index=_.findIndex($scope.carts,{'id':value.id});if(index>=0){$scope.carts[index].quantity++}else{value.quantity=1;$scope.carts.push(value)}};$scope.removeFromList=function(value){var index=_.findIndex($scope.carts,{'id':value.id});if(index>=0){$scope.carts[index].quantity--;if($scope.carts[index].quantity<=0){_.remove($scope.carts,{'id':value.id});Dialog.alert('Order','The item was removed from the order.','OK',2350,'emenu')}}};$scope.categoryHasProducts=function(category){return _.find($scope.collection_items,{'category_id':category.id})!==undefined};$scope.categoryProducts=function(category){return _.filter($scope.collection_items,{'category_id':category.id})};$scope.convertDate=function(date){return $filter('moment_calendar')((new Date(date)).getTime())};$scope.orderItems=function(products){$scope.order_collection_items=[];Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/order_items.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){Loader.show();$scope.is_loading=!0;Emenu.orderItems(products).then(function(data){$scope.order_collection_items=data.collection_items;$scope.order_info=data.order;$scope.fromAdmin=!1;Loader.hide();$scope.is_loading=!1},function(error){Loader.hide();$scope.is_loading=!1;Dialog.alert('Error',error.message,'OK',-1,'emenu')});$scope.orderItemsModal=modal;$scope.orderItemsModal.show()})};$scope.closeOrderItemsModal=function(){if(angular.isObject($scope.orderItemsModal)&&angular.isFunction($scope.orderItemsModal.remove)){$scope.orderItemsModal.remove()}};$scope.payOnlinePayment=function(order_id){$scope.closeOrderItemsModal();Loader.show();$timeout(function(){$state.go("emenu-ewallet",{value_id:$scope.value_id,order_id:order_id},{reload:!0});Loader.hide()},1000)}
$scope.submitOrderNow=function(){if($scope.isUndefined($scope.order.payment_method)||$scope.order.payment_method==''){Dialog.alert($translate.instant("Error","emenu"),$translate.instant("Please select payment mode.","emenu"),'OK',-1,'emenu');return!1}
Loader.show();Emenu.submitOrderNow($scope.order).then(function(data){$scope.carts=[];$scope.action={tab:'menu'};if($scope.order.payment_method=='ewallet'){console.log('data',data);$scope.closeplaceOrderModal().then(function(){Loader.hide();$scope.payOnlinePayment(data.order_id)})}else{Dialog.alert('Thank you',data.message,'OK',-1,'emenu').then(function(){$scope.closeplaceOrderModal().then(function(){Loader.hide();$scope.action.tab='orders';$scope.loadVendorItems(!0)})})}},function(error){Dialog.alert('Error',error.message,'OK',-1,'emenu').then(function(){Loader.hide()})})};$scope.orderCancel=function(order_id){$ionicPopup.show({title:$translate.instant('Confirmation',"emenu"),template:$translate.instant('Are you sure want to Cancel this order?',"emenu"),cssClass:'order-status',scope:$scope,buttons:[{text:$translate.instant('Cancel',"emenu"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK',"emenu"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){Loader.show();Emenu.orderCancel(order_id,'customer').then(function(data){$scope.closeOrderItemsModal();$scope.loadContent(!0);Loader.hide()},function(error){Dialog.alert('Error',error.message,'OK',-1,"emenu")})}})};$scope.viewDesciption=function(description){if(description==''||description==null){return!1}
Dialog.alert('Description',description,'OK',5000,"emenu")}
$scope.loadVendorItems(!0)});angular.module('starter').controller('EmenuOrdersController',function(Dialog,Loader,Customer,$filter,Modal,$ionicPopup,$ionicScrollDelegate,$timeout,$ionicHistory,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.shop=Emenu.getRestaurantInfo();$scope.shop_id=Emenu.shop_id=$scope.shop.id;$scope.payout={orders:{}};$scope.action={tab:'pending'};$scope.can_load_older_items=!1;$scope.use_pull_refresh=!0;$scope.pull_to_refresh=!1;$scope.status_type='pending';$scope.loadContent=function(pullToRefresh){$scope.payout.orders={};$scope.is_loading=!0;Emenu.shopOrders(pullToRefresh,$scope.shop_id,$scope.payout.orders.length,$scope.status_type).then(function(data){$scope.can_load_older_items=!!data.orders.length;$scope.payout=data;$scope.is_loading=!1;if($scope.pull_to_refresh){$scope.$broadcast('scroll.refreshComplete');$scope.pull_to_refresh=!1}},function(error){$scope.is_loading=!1;Dialog.alert('Error',error.message,$translate.instant("OK"),-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent(!1);$scope.pullToRefresh=function(){$scope.pull_to_refresh=!0;$scope.loadContent(!0)};$scope.loadMoreOrders=function(){Emenu.shopOrders(!1,$scope.shop_id,$scope.payout.orders.length,$scope.status_type).then(function(data){$scope.can_load_older_items=!!data.orders.length;$scope.payout.orders=$scope.payout.orders.concat(data.orders);$rootScope.$broadcast("refreshPageSize")},function(error){$scope.can_load_older_items=!1;Dialog.alert('Error',error.message,"OK",-1,"emenu")}).then(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.changeStatus=function(status_type){$scope.status_type=status_type;$scope.action.tab=status_type;$scope.loadContent(!0)};$scope.isMobileNumber=function(mobile_number){var constValue=mobile_number.substring(0,6);if(constValue=='000000'){return!1}
return!0}
$scope.item_image=function(image){if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/application'+image}
return'./features/emenu/assets/media/default-image.png'};$scope.orderFilterMenu=function(){Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/ordes_filter.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.orderFilterMenuModal=modal;$scope.orderFilterMenuModal.show()})};$scope.closeOrderFilterMenuModal=function(){$scope.orderFilterMenuModal.remove()};$scope.convertDate=function(date){return $filter('moment_calendar')((new Date(date)).getTime())};$scope.orderItems=function(order_id){$scope.order_collection_items=[];Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/order_items.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){Loader.show();Emenu.orderItems(order_id).then(function(data){$scope.order_collection_items=data.collection_items;$scope.order_info=data.order;$scope.fromAdmin=!0;Loader.hide()},function(error){Loader.hide();Dialog.alert('Error',error.message,'OK',-1,"emenu")});$scope.orderItemsModal=modal;$scope.orderItemsModal.show()})};$scope.closeOrderItemsModal=function(){$scope.orderItemsModal.remove()};$scope.payOnlinePayment=function(order_id){$scope.closeOrderItemsModal();Loader.show();$timeout(function(){$state.go("emenu-ewallet",{value_id:$scope.value_id,order_id:order_id},{reload:!0});Loader.hide()},1000)}
$scope.orderStatusUpdate=function(order_id){$ionicPopup.show({title:$translate.instant('Confirmation',"emenu"),template:$translate.instant('Are you sure want to change status?',"emenu"),cssClass:'order-status',scope:$scope,buttons:[{text:$translate.instant('Cancel',"emenu"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK',"emenu"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){Loader.show();Emenu.orderStatusUpdate(order_id).then(function(data){$scope.closeOrderItemsModal();$scope.loadContent(!0);Loader.hide()},function(error){Dialog.alert('Error',error.message,'OK',-1,"emenu")})}})};$scope.orderCancel=function(order_id){$ionicPopup.show({title:$translate.instant('Confirmation',"emenu"),template:$translate.instant('Are you sure want to Cancel this order?',"emenu"),cssClass:'order-status',scope:$scope,buttons:[{text:$translate.instant('Cancel',"emenu"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK',"emenu"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){Loader.show();Emenu.orderCancel(order_id,'manager').then(function(data){$scope.closeOrderItemsModal();$scope.loadContent(!0);Loader.hide()},function(error){Dialog.alert('Error',error.message,'OK',-1,"emenu")})}})}});angular.module('starter').controller('EmenuAccountsController',function(Dialog,$timeout,SocialSharing,$ionicScrollDelegate,Loader,Application,$ionicPopup,$cordovaCamera,Customer,Modal,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate,$ionicActionSheet){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.shop=Emenu.getRestaurantInfo();$scope.shop_id=Emenu.shop_id=$scope.shop.id;$scope.login_customer_id=Customer.id;$scope.payout={accounts:{}};$scope.use_pull_refresh=!0;$scope.pull_to_refresh=!1;$scope.loadContent=function(pullToRefresh){$scope.payout.accounts={};$scope.is_loading=!0;Emenu.shopAccounts(pullToRefresh,$scope.shop_id).then(function(data){$scope.payout=data;$scope.is_loading=!1;if($scope.pull_to_refresh){$scope.$broadcast('scroll.refreshComplete');$scope.pull_to_refresh=!1}},function(error){$scope.is_loading=!1;Dialog.alert('Error',error.message,'OK',-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent(!1);$scope.pullToRefresh=function(){$scope.pull_to_refresh=!0;$scope.loadContent(!0)};$scope.customer_avatar=function(image){if(image!==''&&image!=null&&image!=='null'){return IMAGE_URL+'images/customer'+image}
return'./features/emenu/assets/media/customer-placeholder.png'};$scope.addAccount=function(){$scope.account={shop_id:$scope.shop_id,firstname:'',lastname:'',email:'',password:'',designation:''};Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/add_managers.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.addAccountModal=modal;$scope.addAccountModal.show()})};$scope.closeAddAccountModal=function(){$scope.addAccountModal.remove()}
$scope.accountSave=function(){Loader.show();Emenu.accountSave($scope.account).success(function(data){$scope.pullToRefresh();Loader.hide();Dialog.alert('Success',data.message,'Ok',-1,'emenu');$scope.closeAddAccountModal()}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,'emenu')})};$scope.managePermission=function(managerInfo){Modal.fromTemplateUrl('features/emenu/assets/templates/l1/modal/permission_managers.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.managerInfo=managerInfo;$scope.managePermissionModal=modal;$scope.managePermissionModal.show()})};$scope.closeManagePermissionModal=function(){$scope.managePermissionModal.remove()}
$scope.accountPermissionSave=function(){Loader.show();Emenu.pemissionUpdate($scope.managerInfo.id,$scope.managerInfo.features_allow).success(function(data){Loader.hide();Dialog.alert('Success',data.message,'Ok',-1,"emenu");$scope.closeManagePermissionModal();$scope.loadContent(!0)}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,"emenu")})}
$scope.accountSheetOption=function(managerInfo){var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant('Manage Permission',"emenu")},{text:$translate.instant("Delete","emenu")}],cancelText:$translate.instant("Cancel","emenu"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){$scope.managePermission(managerInfo)}
if(index==1){$scope.deleteAccount(managerInfo.id)}
return!0}})}
$scope.deleteAccount=function(account_id){$ionicPopup.show({title:$translate.instant('Delete',"emenu"),template:$translate.instant('Are you sure want to delete?',"emenu"),cssClass:'item-status',scope:$scope,buttons:[{text:$translate.instant('Cancel',"emenu"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK',"emenu"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){Loader.show();Emenu.deleteAccount(account_id).success(function(data){Loader.hide();Dialog.alert('Success',data.message,'Ok',-1,"emenu");$scope.loadContent(!0)}).error(function(error){Loader.hide();Dialog.alert('Error',error.message,'Ok',-1,"emenu")})}})}});angular.module('starter').controller('EmenuSettingsController',function(Dialog,$timeout,SocialSharing,$ionicScrollDelegate,Loader,Application,$ionicPopup,$cordovaCamera,Customer,Modal,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate,$ionicActionSheet){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.shop=Emenu.getRestaurantInfo();$scope.shop_id=Emenu.shop_id=$scope.shop.id;$scope.login_customer_id=Customer.id;$scope.use_pull_refresh=!0;$scope.pull_to_refresh=!1;$scope.payout={accounts:{}};$scope.loadContent=function(pullToRefresh){$scope.payout.settings={};$scope.is_loading=!0;Emenu.shopSettings(pullToRefresh,$scope.shop_id).then(function(data){$scope.payout=data;$scope.is_loading=!1;if($scope.pull_to_refresh){$scope.$broadcast('scroll.refreshComplete');$scope.pull_to_refresh=!1}},function(error){$scope.is_loading=!1;Dialog.alert('Error',error.message,'OK',-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent(!1);$scope.pullToRefresh=function(){$scope.pull_to_refresh=!0;$scope.loadContent(!0)};$scope.changeStatus=function(){Emenu.changeShopSettings($scope.shop_id,$scope.payout.settings).then(function(data){},function(error){$scope.loadContent();Dialog.alert('Error',error.message,'OK',-1)})}});angular.module('starter').controller('EmenuEwalletController',function(Dialog,Loader,Customer,$filter,Modal,$ionicPopup,$ionicScrollDelegate,$timeout,$ionicHistory,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate,Ewallet,$ionicHistory,$ionicSideMenuDelegate){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.order_id=$stateParams.order_id;$scope.is_loading=!1;$scope.shop_id=Emenu.vendor_id;$scope.loadContent=function(){$scope.cart=Ewallet.getPaycart();if(!Emenu.isUndefined($scope.cart.method)||$scope.cart.method=='payToModule'){$ionicHistory.goBack()}
Loader.show();Emenu.orderItems($scope.order_id).then(function(data){$scope.cart.order_id=$scope.order_id;$scope.cart.shop_id=$scope.shop_id;$scope.cart.amount=data.order.total_amount;$scope.cart.remark=data.title;$scope.cart.return_state_name='emenu-ewallet-return';$scope.cart.return_value_id=$scope.value_id;Ewallet.setPaycart($scope.cart);$ionicHistory.nextViewOptions({disableBack:!0});$ionicSideMenuDelegate.canDragContent(!1);$state.go("ewallet-module-payment",{value_id:data.order.ewallet_value_id},{reload:!0});Loader.hide()},function(error){Loader.hide();Dialog.alert('Error',error.message,'OK',-1,"emenu")})}
$scope.loadContent()}).controller('EmenuEwalletReturnController',function(Dialog,Loader,Customer,$filter,Modal,$ionicPopup,$ionicScrollDelegate,$timeout,$ionicHistory,$rootScope,SB,Emenu,$scope,$state,$stateParams,$translate,Ewallet,$ionicHistory,$ionicSideMenuDelegate){$scope.value_id=Emenu.value_id=$stateParams.value_id;$scope.cart=Ewallet.getPaycart();console.log($scope.cart);$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1,disableBack:!0});$ionicSideMenuDelegate.canDragContent(!1);Loader.show();Emenu.updatePaymentStatus($scope.cart).then(function(data){Loader.hide();if($scope.cart.status=='success'){Dialog.alert($translate.instant("Error","emenu"),$translate.instant("Payment has been successfully","emenu"),$translate.instant("OK","emenu"),-1,"emenu")}
if($scope.cart.status=='failed'){Dialog.alert($translate.instant("Error","emenu"),$translate.instant("Payment has been failed","emenu"),$translate.instant("OK","emenu"),-1,"emenu")}
Ewallet.setPaycart({});$state.go('home').then(function(){$state.go('emenu-home-customer',{value_id:$scope.value_id,vendor_id:$scope.cart.shop_id},{reload:!0})})},function(error){Loader.hide();Dialog.alert($translate.instant("Error","emenu"),error.message,$translate.instant("OK","emenu"),-1,"emenu")})});angular.module('starter').factory('Emenu',function(Url,$rootScope,$pwaRequest,$session){var factory={value_id:null,shop_id:null,vendor_id:null,permission:null};factory.setValueId=function(valueId){factory.value_id=valueId;return factory};factory.getValueId=function(){return factory.value_id};factory.setRestaurantInfo=function(info){factory.info=info;return factory};factory.getRestaurantInfo=function(){return factory.info};factory.setPermissions=function(permissionValues){factory.permission=permissionValues;return factory};factory.getPermissions=function(){return factory.permission};factory.setCategory=function(category){factory.category=category;return factory};factory.getCategory=function(){return factory.category};factory.setItemFilter=function(filter){factory.filter=filter;return factory};factory.getItemFilter=function(){return factory.filter};factory.findAll=function(id){return $pwaRequest.post('emenu/mobile_view/find-all',{data:{value_id:factory.value_id,customer_id:id},refresh:!0})};factory.saveRestaurant=function(param){return $pwaRequest.post('emenu/mobile_view/save-restaurant',{urlParams:{value_id:factory.value_id},data:param})};factory.categorySave=function(param){return $pwaRequest.post('emenu/mobile_category/add-category',{urlParams:{value_id:factory.value_id},data:param})};factory.loadCategory=function(shop_id){return $pwaRequest.post('emenu/mobile_category/load-category',{urlParams:{value_id:factory.value_id,shop_id:shop_id}})};factory.getQRCode=function(shop_id){var myOptions={};return Url.get('/emenu/mobile_view/get-qr-code',angular.extend({},myOptions,{value_id:factory.value_id,shop_id:shop_id}))+($rootScope.isOffline?'':'?'+(+new Date()))};factory.updateStatusCategory=function(param){return $pwaRequest.post('emenu/mobile_category/update-status',{urlParams:{value_id:factory.value_id},data:param})};factory.updateStatusItem=function(param){return $pwaRequest.post('emenu/mobile_items/update-status',{urlParams:{value_id:factory.value_id},data:param})};factory.updatePaymentStatus=function(param){return $pwaRequest.post('emenu/mobile_view/update-payment-status',{urlParams:{value_id:factory.value_id},data:param})};factory.markUpdateItem=function(param){return $pwaRequest.post('emenu/mobile_items/mark-update',{urlParams:{value_id:factory.value_id},data:param})};factory.loadSpecialPopularItems=function(shop_id,action){return $pwaRequest.post('emenu/mobile_items/special-popular',{urlParams:{value_id:factory.value_id,shop_id:shop_id,a:action},refresh:!0})};factory.loadItems=function(shop_id,offset,filterValues){return $pwaRequest.post('emenu/mobile_items/load-items',{urlParams:{value_id:factory.value_id,shop_id:shop_id,offset:offset},data:filterValues,refresh:!0})};factory.itemSave=function(param){return $pwaRequest.post('emenu/mobile_items/add-item',{urlParams:{value_id:factory.value_id},data:param})};factory.sliderSave=function(param){return $pwaRequest.post('emenu/mobile_view/add-slider',{urlParams:{value_id:factory.value_id},data:param})};factory.loadSlider=function(shop_id){return $pwaRequest.post('emenu/mobile_view/load-slider',{urlParams:{value_id:factory.value_id,shop_id:shop_id}})};factory.loadVendorItems=function(vendor_id,offset,filterValues,refresh){var localRefresh=refresh===undefined?!1:refresh;return $pwaRequest.post('emenu/mobile_items/load-vendor-items',{urlParams:{value_id:factory.value_id,vendor_id:vendor_id,offset:offset,device_uid:$session.getDeviceUid()},data:filterValues,refresh:localRefresh})};factory.loginUser=function(param,shop_id){return $pwaRequest.post('emenu/mobile_view/login-user',{urlParams:{value_id:factory.value_id,device_uid:$session.getDeviceUid(),shop_id:shop_id},data:param,cache:!1,refresh:!0})};factory.submitOrderNow=function(param){return $pwaRequest.post('emenu/mobile_view/order-submit',{urlParams:{value_id:factory.value_id,device_uid:$session.getDeviceUid()},data:param,refresh:!0})};factory.orderItems=function(order_id){return $pwaRequest.post('emenu/mobile_view/order-items',{urlParams:{value_id:factory.value_id,order_id:order_id},refresh:!0})};factory.shopOrders=function(pullToRefresh,shop_id,offset,status_type){return $pwaRequest.post('emenu/mobile_view/shop-orders',{urlParams:{value_id:factory.value_id,shop_id:shop_id,offset:offset,status:status_type},refresh:pullToRefresh})};factory.shopCustomers=function(pullToRefresh,shop_id,offset){return $pwaRequest.post('emenu/mobile_view/shop-customers',{urlParams:{value_id:factory.value_id,shop_id:shop_id,offset:offset},refresh:pullToRefresh})};factory.shopAccounts=function(pullToRefresh,shop_id){return $pwaRequest.post('emenu/mobile_accounts/findall',{urlParams:{value_id:factory.value_id,shop_id:shop_id},refresh:pullToRefresh})};factory.deleteAccount=function(account_id){return $pwaRequest.post('emenu/mobile_accounts/delete',{urlParams:{value_id:factory.value_id,account_id:account_id},refresh:!0})};factory.pemissionUpdate=function(account_id,permission){return $pwaRequest.post('emenu/mobile_accounts/pemission-update',{urlParams:{value_id:factory.value_id,account_id:account_id},data:permission,refresh:!0})};factory.accountSave=function(param){return $pwaRequest.post('emenu/mobile_accounts/save',{urlParams:{value_id:factory.value_id,},data:param})};factory.orderStatusUpdate=function(order_id){return $pwaRequest.post('emenu/mobile_view/order-status-update',{urlParams:{value_id:factory.value_id,order_id:order_id}})};factory.orderCancel=function(order_id,cancel_by){return $pwaRequest.post('emenu/mobile_view/order-cancel',{urlParams:{value_id:factory.value_id,order_id:order_id,cancel_by:cancel_by}})};factory.shopSettings=function(pullToRefresh,shop_id){return $pwaRequest.post('emenu/mobile_view/shop-settings',{urlParams:{value_id:factory.value_id,shop_id:shop_id},refresh:pullToRefresh})};factory.changeShopSettings=function(shop_id,settings){return $pwaRequest.post('emenu/mobile_view/shop-settings-update',{urlParams:{value_id:factory.value_id,shop_id:shop_id},data:settings,refresh:!0})};factory.isUndefined=function(thing){return(typeof thing==="undefined")}
return factory});angular.module('starter').factory('EmenuInit',function($location,$stateParams,$timeout,$translate,$ionicHistory,$state,$session,Loader){var factory={};factory.loadVendor=function(parts){if(parts!==null&&parts.length===3){Loader.show($translate.instant('Loading menu...','emenu'));$timeout(function(){Loader.hide();$ionicHistory.nextViewOptions({disableBack:!0});$state.go('emenu-home-customer',{value_id:parts[1],vendor_id:parts[2]})},100)}};factory.onStart=function(){var hash=HASH_ON_START.match(/\?__goto__=(.*)/);if(hash&&hash.length>=2){var path=hash[1];var parts=path.match(/\/emenu\/([0-9]+)\/([0-9]+)/);if(parts&&parts.length===3){$session.setItem('emenu-last-vendor-id',parts);factory.loadVendor(parts)}}else{$session.getItem('emenu-last-vendor-id').then(function(parts){factory.loadVendor(parts)})}};return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.emenu .remove-border{border:0}.emenu .margin-top-30{margin-top:30px}.emenu .button-floating-action{position:fixed!important;top:calc(90vh - 60px)!important;right:10vw!important;border-radius:100px!important;border-width:0!important;padding:5px 12px 5px 12px!important;z-index:999!important;box-shadow:5px 5px 5px #888!important}.emenu .input-label{width:63%!important}.emenu .emenu-save-button{width:90%}.emenu .menu-icon{font-size:36px}.emenu .disabled{opacity:.5;pointer-events:none}.emenu .cliams-add-images-box{display:inline-block;position:relative}.emenu .emenu-add-images-box-icon{position:absolute;top:5px;right:5px;color:#fff;background:#992000;padding:6px 10px 4px;border-radius:4px}.emenu.emenu-orders i.ion-person{font-size:initial}.emenu .item .badge{position:unset!important;float:right!important}.emenu .item-quantity{width:100px!important}.emenu .item-quantity i{right:unset!important;display:inline-block;position:unset!important;font-size:24px}.emenu .item-quantity .quantity{line-height:20px;display:inline-block;transform:translateY(-6px);margin:0 8px;padding:4px;font-size:18px;font-weight:700}.emenu .item-note{color:#0c0c0d;font-size:16px}","emenu")