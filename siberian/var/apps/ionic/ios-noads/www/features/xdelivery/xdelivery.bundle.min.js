angular.module('starter').controller('XdeliveryHomeController',function(Dialog,Loader,Customer,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.payout={};$scope.settings={};$scope.loadContent=function(){$scope.is_loading=!0;Xdelivery.findAll().then(function(data){$scope.page_title=data.page_title;$scope.payout=data;$scope.settings=Xdelivery.settings=data.settings},function(error){$scope.is_loading=!1;Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent();$scope.CategoryImage=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/application'+image}else{return"./features/xdelivery/assets/media/default-image.png"}};$scope.SliderImage=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/application'+image}else{return"./features/xdelivery/assets/media/default-image.png"}}}).controller('XdeliveryCartController',function(Dialog,Loader,$timeout,Customer,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery,$ionicActionSheet,$session){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.payout={};$scope.settings=Xdelivery.settings;$scope.carts=Xdelivery.carts;$scope.ProductImage=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/application'+image}else{return"./features/xdelivery/assets/media/default-image.png"}};$scope.loadContent=function(is_loading=!0){console.log("settings",$scope.settings);$scope.is_loading=is_loading;Xdelivery.cartProduct().then(function(data){$scope.payout=data;Xdelivery.carts.main=data;if(data.in_out_of_stock){Dialog.alert($translate.instant("Warring"),data.in_out_of_stock+' '+$translate.instant("Item out of stock, Please remove from your cart!"),$translate.instant("OK"),-1)}},function(error){$scope.is_loading=!1;Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent(!0);$scope.increaseQuantity=function(product_id,cart_key,current_qty){if($scope.settings.max_qty_per_product<current_qty){Dialog.alert($translate.instant("Error"),$translate.instant("Quantity of products in cart must be "+$scope.settings.max_qty_per_product+" or less","xdelivery"),$translate.instant("OK"),-1);return!0}
Loader.show();Xdelivery.increaseQuantity(product_id,cart_key).success(function(data){$scope.loadContent(!1)},function(error){Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).then(function(){Loader.hide()})};$scope.decreaseQuantity=function(product_id,cart_key){Loader.show();Xdelivery.decreaseQuantity(product_id,cart_key).success(function(data){$scope.loadContent(!1)},function(error){Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).then(function(){Loader.hide()})};$scope.login=function(){var oldDeviceUid=$session.getDeviceUid();if(!Customer.isLoggedIn()){Customer.loginModal($scope,function(){Loader.show();$timeout(function(){Xdelivery.syncDeviceAndCustomerCart(oldDeviceUid).success(function(data){$scope.loadContent(!0)},function(error){Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).then(function(){Loader.hide()});$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;$state.go('home').then(function(){$state.go("xdelivery-home",{value_id:$scope.value_id},{reload:!0}).then(function(){Loader.hide();$state.go("xdelivery-cart",{value_id:$scope.value_id},{reload:!0})})})},1000)})}}
$scope.checkoutNow=function(){if(!Customer.isLoggedIn()){$scope.login();return!0}
if($scope.settings.min_qty_shopping_cart>$scope.payout.total_item){Dialog.alert($translate.instant("Error"),$translate.instant("Minimum order quantity required","xdelivery")+' '+$scope.settings.min_qty_shopping_cart,$translate.instant("OK"),-1);return!0}
if($scope.settings.max_qty_shopping_cart<$scope.payout.total_item){Dialog.alert($translate.instant("Error"),$translate.instant("Maximum order quantity allowed is","xdelivery")+' '+$scope.settings.min_qty_shopping_cart,$translate.instant("OK"),-1);return!0}
if($scope.settings.min_order_value>$scope.payout.total_amount){Dialog.alert($translate.instant("Error"),$translate.instant("Minimum order amount required","xdelivery")+' '+$scope.settings.min_order_value,$translate.instant("OK"),-1);return!0}
if($scope.settings.max_order_value<$scope.payout.total_amount){Dialog.alert($translate.instant("Error"),$translate.instant("Maximum order amount allowed","xdelivery")+' '+$scope.settings.min_order_value,$translate.instant("OK"),-1);return!0}
if(!$scope.settings.enable_to_deliver&&!$scope.settings.enable_to_pickup){Xdelivery.carts.delivery='delivery';$state.go("xdelivery-checkout",{value_id:$scope.value_id},{reload:!0});return!0}
if(!$scope.settings.enable_to_deliver&&$scope.settings.enable_to_pickup){Xdelivery.carts.delivery='pickup';$state.go("xdelivery-checkout",{value_id:$scope.value_id},{reload:!0});return!0}
if($scope.settings.enable_to_deliver&&!$scope.settings.enable_to_pickup){Xdelivery.carts.delivery='delivery';$state.go("xdelivery-checkout",{value_id:$scope.value_id},{reload:!0});return!0}
var buttonIndexing=[];var buttonPositon=0;var sheetButtons=[];if($scope.settings.enable_to_deliver){sheetButtons[buttonPositon]={text:$translate.instant("Home Delivery",'xdelivery')};buttonIndexing[buttonPositon]='delivery';buttonPositon=buttonPositon+1}
if($scope.settings.enable_to_pickup){sheetButtons[buttonPositon]={text:$translate.instant("Pick-up",'xdelivery')};buttonIndexing[buttonPositon]='pickup';buttonPositon=buttonPositon+1}
var hideSheet=$ionicActionSheet.show({buttons:sheetButtons,cancelText:$translate.instant("Cancel","xdelivery"),titleText:$translate.instant("Your order","xdelivery"),cancel:function(){hideSheet()},buttonClicked:function(index){Xdelivery.carts.delivery='delivery';if(buttonIndexing[index]=="delivery"){Xdelivery.carts.delivery='delivery'}
if(buttonIndexing[index]=="pickup"){Xdelivery.carts.delivery='pickup'}
$state.go("xdelivery-checkout",{value_id:$scope.value_id},{reload:!0})}})}});angular.module('starter').controller('XdeliveryProductController',function(Dialog,Loader,$timeout,$controller,$ionicModal,Customer,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery){angular.extend(this,$controller('XdeliveryProductCommanController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams}));$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.category_id=$stateParams.category_id;$scope.is_loading=!1;$scope.payout={};$scope.settings=Xdelivery.settings;$scope.pull_to_refresh=!1;$scope.loadContent=function(){if(!$scope.category_id){return!1}
$scope.payout.products={};$scope.is_loading=!0;Xdelivery.getProductsByCategoryId($scope.category_id,$scope.payout.products.length,!1).then(function(data){$scope.can_load_older_items=!!data.products.length;$scope.payout=data},function(error){$scope.is_loading=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK"),-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent();$scope.loadMoreProducts=function(){Xdelivery.getProductsByCategoryId($scope.category_id,$scope.payout.products.length,!1).then(function(data){$scope.can_load_older_items=!!data.products.length;$scope.payout.products=$scope.payout.products.concat(data.products);$rootScope.$broadcast("refreshPageSize")},function(error){$scope.can_load_older_items=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK"),-1)}).then(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})}}).controller('XdeliveryCategoryController',function(Dialog,Loader,Customer,$controller,$ionicModal,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery){angular.extend(this,$controller('XdeliveryProductCommanController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams}));$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.parent_id=$stateParams.parent_id;$scope.is_loading=!1;$scope.payout={};$scope.pull_to_refresh=!1;$scope.settings=Xdelivery.settings;$scope.loadContent=function(refresh){$scope.is_loading=!0;$scope.payout.products={};Xdelivery.getCategoryByParentId($scope.parent_id,$scope.payout.products.length,refresh).then(function(data){$scope.can_load_older_items=!!data.products.length;$scope.payout=data;if($scope.pull_to_refresh){$scope.$broadcast('scroll.refreshComplete');$scope.pull_to_refresh=!1}},function(error){$scope.is_loading=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK"),-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent(!1);$scope.CategoryImage=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/application'+image}else{return"./features/xdelivery/assets/media/default-image.png"}};$scope.SliderImage=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/application'+image}else{return"./features/xdelivery/assets/media/default-image.png"}};$scope.pullToRefresh=function(){$scope.pull_to_refresh=!0;$scope.loadContent(!0)};$scope.loadMoreProducts=function(){Xdelivery.getCategoryByParentId($scope.parent_id,$scope.payout.products.length,!1).then(function(data){$scope.can_load_older_items=!!data.products.length;$scope.payout.products=$scope.payout.products.concat(data.products);$rootScope.$broadcast("refreshPageSize")},function(error){$scope.can_load_older_items=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK"),-1)}).then(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})}}).controller('XdeliveryProductCommanController',function(Dialog,Loader,Customer,$ionicModal,$timeout,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery,$ionicPopup){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.payout={};$scope.cart={};$scope.settings=Xdelivery.settings;$scope.getProductDetailsInfo=function(product_id){Xdelivery.findByProductId(product_id).success(function(data){$timeout(function(){$scope.product_details=data.product;if($scope.product_details.is_multiple_options){$scope.cart.child_product_id=data.product.selected_product_id}else{$scope.cart.child_product_id=0;$scope.cart.product_id=product_id}
$scope.product_details.fixed_image=$scope.product_details.image;Loader.hide();$scope.is_loading=!1},300)}).error(function(error){Loader.hide();$scope.is_loading=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,"OK",-1,"xdelivery")})}
$scope.productDeails=function(product_id){$scope.is_loading=!0;Loader.show();$scope.product_details={};$scope.cart={};$scope.cart.product_id=product_id;$scope.cart.qty=1;$scope.cart.options=[];$ionicModal.fromTemplateUrl('features/xdelivery/assets/templates/l1/modal/product_details.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.getProductDetailsInfo(product_id);$scope.modalProductDetails=modal;$scope.modalProductDetails.show()})};$scope.closeModalProductDetails=function(){$scope.modalProductDetails.remove()}
$scope.toppingOptionsModal=function(topping){Loader.show();$scope.product_options={topping:topping,values:{}};$ionicModal.fromTemplateUrl('features/xdelivery/assets/templates/l1/modal/options_values.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){Xdelivery.findOptionsValuesById(topping.option_id).success(function(data){$scope.product_options.values=data.values;Loader.hide()}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","xdelivery"),error.message,"OK",-1,"xdelivery")});$scope.modalToppingOptions=modal;$scope.modalToppingOptions.show()})};$scope.closeToppingOptionsModal=function(){$scope.modalToppingOptions.remove()}
$scope.ProductImage=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/application'+image}else{return"./features/xdelivery/assets/media/default-image.png"}};$scope.addToOption=function(option,input_type){for(var item in $scope.cart.options){if($scope.cart.options[item].id===option.id){$scope.cart.options.splice(item,1);return}}
var pdata={};pdata.id=option.id;pdata.option_id=option.option_id;pdata.name=option.name;pdata.price=option.price;$scope.cart.options.push(pdata)}
$scope.checkedOption=function(option){for(var item in $scope.cart.options){if($scope.cart.options[item].id===option.id){return!0}}}
$scope.toppingSelectedSum=function(option_id){var sum=0;for(var item in $scope.cart.options){if($scope.cart.options[item].option_id===option_id){sum=sum+parseFloat($scope.cart.options[item].price)}}
return sum}
$scope.totalToppingSum=function(options){var sum=0;for(var item in options){sum=sum+parseFloat(options[item].price)}
return sum}
$scope.choiceVariantProduct=function(varient_product){$scope.cart.child_product_id=varient_product.varient_product_id;$scope.product_details.selected_product_id=varient_product.varient_product_id;$scope.product_details.active_special_price=varient_product.active_special_price;$scope.product_details.in_stock=varient_product.in_stock;$scope.product_details.low_stock_threshold=varient_product.low_stock_threshold;$scope.product_details.manage_stock=varient_product.manage_stock;$scope.product_details.price=varient_product.price;$scope.product_details.qty=varient_product.qty;$scope.product_details.selling_price=varient_product.selling_price;$scope.product_details.sku=varient_product.sku;$scope.product_details.special_price=varient_product.special_price;$scope.product_details.special_price_end=varient_product.special_price_end;$scope.product_details.special_price_start=varient_product.special_price_start;$scope.product_details.tax_rate=varient_product.tax_rate;if(varient_product.product_image!=''&&varient_product.product_image!=null){$scope.product_details.image=varient_product.product_image}else{$scope.product_details.image=$scope.product_details.fixed_image}}
$scope.checkedProduct=function(product_id){if($scope.cart.child_product_id==product_id){return!0}}
$scope.addToCart=function(cart){$scope.cart.amount=parseFloat($scope.product_details.selling_price);$scope.cart.sub_amount=($scope.cart.qty*$scope.product_details.selling_price);$scope.cart.total_amount=$scope.cart.sub_amount+$scope.totalToppingSum($scope.cart.options);$scope.cart.tax_amount=0;console.log($scope.cart);Loader.show();Xdelivery.addToCart($scope.cart).success(function(data){$scope.getProductDetailsInfo($scope.cart.product_id);$ionicPopup.show({title:$translate.instant('Success',"xdelivery"),template:$translate.instant('Product is added to cart!',"xdelivery"),cssClass:'delete-status',scope:$scope,buttons:[{text:$translate.instant('Continue Shopping',"xdelivery"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('Go To Cart',"xdelivery"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){$scope.closeModalProductDetails();if(result){$state.go("xdelivery-cart",{value_id:$scope.value_id},{reload:!0})}})},function(error){Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).then(function(){Loader.hide()})}
$scope.saveForLater=function(product_id){Loader.show();Xdelivery.saveForLater(product_id).success(function(data){$scope.getProductDetailsInfo(product_id)},function(error){Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).then(function(){Loader.hide()})};$scope.addAddressModal=function(isEdit,address_post={}){if(isEdit){$scope.page_title=$translate.instant('Edit Address',"xdelivery");$scope.address_post=address_post}else{$scope.page_title=$translate.instant('Add Address',"xdelivery");$scope.address_post={customer_name:'',phone_number:'',is_default:0,address_type:'home',address:'',pincode:'',city:''}}
$ionicModal.fromTemplateUrl('features/xdelivery/assets/templates/l1/account/add_address.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){$scope.modalAddress=modal;$scope.modalAddress.show()})}
$scope.closeAddAddressModal=function(){$scope.modalAddress.remove()}
$scope.addAddress=function(param){Loader.show();Xdelivery.saveAddress(param).then(function(data){Dialog.alert($translate.instant("Success"),data.message,$translate.instant("OK"),-1);$scope.closeAddAddressModal()},function(error){Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).then(function(){Loader.hide()})}}).controller('XdeliverySearchController',function(Dialog,$controller,$ionicModal,Loader,Customer,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.settings=Xdelivery.settings;$scope.use_pull_refresh=!0;$scope.pull_to_refresh=!1;$scope.payout={products:{},search_text:'',popular_suggestions:{}};angular.extend(this,$controller('XdeliveryProductCommanController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams}));$scope.loadContent=function(){$scope.is_loading=!0;Xdelivery.popularSuggestions($scope.value_id).then(function(data){$scope.payout.popular_suggestions=data.popular_suggestions},function(error){$scope.is_loading=!1;Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent();$scope.loadSearchContent=function(pullToRefresh=!0){$scope.payout.search_text=document.getElementById("productSearch").value;if($scope.payout.search_text==''){$scope.payout.products={};if($scope.pull_to_refresh){$scope.$broadcast('scroll.refreshComplete');$scope.pull_to_refresh=!1}
return!1}
$scope.is_loading=!0;$scope.payout.products={};Xdelivery.findProductsSearch(pullToRefresh,$scope.payout.products.length,$scope.payout.search_text.trim()).success(function(data){$scope.can_load_older_items=!!data.products.length;$scope.payout.products=data.products;$scope.is_loading=!1;if($scope.pull_to_refresh){$scope.$broadcast('scroll.refreshComplete');$scope.pull_to_refresh=!1}},function(error){$scope.pull_to_refresh=!1;$scope.is_loading=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK"),-1)})};$scope.pullToRefresh=function(){$scope.pull_to_refresh=!0;$scope.loadSearchContent(!0)};$scope.loadMoreProducts=function(){$scope.payout.search_text=document.getElementById("productSearch").value;Xdelivery.findProductsSearch(!1,$scope.payout.products.length,$scope.payout.search_text).success(function(data){$scope.can_load_older_items=!!data.products.length;$scope.payout.products=$scope.payout.products.concat(data.products);$rootScope.$broadcast("refreshPageSize")}).error(function(error){$scope.can_load_older_items=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,"OK",-1,"xdelivery")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})}
$scope.forTranslate=function(text){return $translate.instant(text,"xdelivery")}});angular.module('starter').controller('XdeliveryAccountController',function(Dialog,$timeout,Loader,Customer,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.payout={};$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;$scope.settings=Xdelivery.settings;$scope.login=function(){if(!Customer.isLoggedIn()){Customer.loginModal($scope,function(){Loader.show();$timeout(function(){$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;$state.go('home').then(function(){$state.go("xdelivery-home",{value_id:$scope.value_id},{reload:!0}).then(function(){Loader.hide();$state.go("xdelivery-account",{value_id:$scope.value_id},{reload:!0})})})},1000)})}}
$rootScope.$on(SB.EVENTS.AUTH.loginSuccess,function(){if($scope.value_id){$scope.loadContent()}
$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer});$rootScope.$on(SB.EVENTS.AUTH.logoutSuccess,function(){if($scope.value_id){$scope.loadContent()}
$scope.loadContent();$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer});$scope.customer_avatar=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/customer'+image}else{return"./features/xdelivery/assets/media/customer-placeholder.png"}};$scope.loadContent=function(){console.log('Customer',$scope.customer)}}).controller('XdeliveryWishlistController',function(Dialog,$controller,Loader,Customer,$ionicModal,$timeout,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.payout={};$scope.is_favourite=!0;angular.extend(this,$controller('XdeliveryProductCommanController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams}));$scope.loadContent=function(){$scope.is_loading=!0;Xdelivery.findWishlist().then(function(data){$scope.payout=data},function(error){$scope.is_loading=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK","xdelivery"),-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent();$scope.$on('modal.hidden',function(){$scope.loadContent()});$scope.removeWishlist=function(product_id){Loader.show();Xdelivery.saveForLater(product_id).success(function(data){$scope.loadContent()},function(error){Loader.hide();Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK"),-1)}).then(function(){Loader.hide()})}}).controller('XdeliveryAddressController',function(Dialog,$controller,Loader,Customer,$ionicModal,$timeout,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery,$ionicPopup){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.payout={};$scope.address_post={};angular.extend(this,$controller('XdeliveryProductCommanController',{Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams}));$scope.loadContent=function(){$scope.is_loading=!0;Xdelivery.findAddress().then(function(data){$scope.payout=data},function(error){$scope.is_loading=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK","xdelivery"),-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent();$scope.$on('modal.hidden',function(){$scope.loadContent()});$scope.forTranslate=function(text){return $translate.instant(text,"xdelivery")}
$scope.deleteAddress=function(address_id){$ionicPopup.show({title:$translate.instant('Confirm',"xdelivery"),template:$translate.instant('Are you sure want to Delete?',"xdelivery"),cssClass:'delete-status',scope:$scope,buttons:[{text:$translate.instant('Cancel',"xdelivery"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK',"xdelivery"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){Loader.show();Xdelivery.deleteAddress(address_id).then(function(data){Dialog.alert($translate.instant("Success","xdelivery"),data.message,$translate.instant("OK","xdelivery"),-1);$scope.loadContent()},function(error){Loader.hide();Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK","xdelivery"),-1)}).then(function(){Loader.hide()})}})}});angular.module('starter').controller('XdeliveryCheckoutController',function(Dialog,Loader,$controller,Customer,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.carts={};$scope.payout={};$scope.is_logged_in=Customer.isLoggedIn();$scope.settings=Xdelivery.settings;$scope.is_today=!1;$scope.is_display_all_address=!1;$scope.is_allow_select_date=!1;$scope.is_allow_select_time=!1;angular.extend(this,$controller('XdeliveryProductCommanController',{Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams}));$scope.loadContent=function(){$scope.is_loading=!0;$scope.carts=Xdelivery.carts;if($scope.carts.delivery=='pickup'){$scope.carts.customer=Customer.customer;if($scope.settings.enable_to_pickup){if($scope.settings.enable_date_to_pickup){$scope.is_allow_select_date=!0}
if($scope.settings.enable_time_to_pickup){$scope.is_allow_select_time=!0}}}else{if($scope.settings.enable_to_deliver){if($scope.settings.enable_date_to_deliver){$scope.is_allow_select_date=!0}
if($scope.settings.enable_time_to_deliver){$scope.is_allow_select_time=!0}}}
Xdelivery.checkoutScreen($scope.carts.delivery).then(function(data){$scope.payout=data;if($scope.payout.address.length){$scope.carts.address=$scope.payout.address[0].id}
$scope.carts.delivery_date=data.today_date;if(Xdelivery.isUndefined($scope.carts.delivery_time)){$scope.carts.delivery_time=''}
$scope.is_today=!0},function(error){$scope.is_loading=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK","xdelivery"),-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent();$scope.forTranslate=function(text){return $translate.instant(text,"xdelivery")}
$scope.isTimeAvailable=function(time){if($scope.carts.delivery_date==$scope.payout.today_date){$scope.is_today=!0;if((time<$scope.payout.current_time)){return!0}else{return!1}}
$scope.is_today=!1;return!1}
$scope.deliveryDateChange=function(){$scope.carts.delivery_time='';$scope.isTimeAvailable()}
$scope.showHideAddress=function(){if($scope.is_display_all_address){$scope.is_display_all_address=!1}else{$scope.is_display_all_address=!0}}
$scope.continueOrder=function(){if($scope.carts.delivery_time==''&&$scope.is_allow_select_time){Dialog.alert($translate.instant("Error","xdelivery"),$translate.instant("Please select a time","xdelivery"),$translate.instant("OK","xdelivery"),-1);return!0}
Xdelivery.carts=$scope.carts;$state.go("xdelivery-payment",{value_id:$scope.value_id},{reload:!0})}
$scope.$on('modal.hidden',function(){$scope.loadContent()})}).controller('XdeliveryPaymentController',function(Dialog,Loader,Customer,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.is_loading=!1;$scope.carts={};$scope.payout={};$scope.settings=Xdelivery.settings;$scope.loadContent=function(){$scope.is_loading=!0;$scope.carts=Xdelivery.carts;if(Xdelivery.isUndefined($scope.carts.main)||$scope.carts.main.cart_products.length==0){Loader.show();$state.go("home",{value_id:$scope.value_id},{reload:!0}).then(function(){Loader.hide();$state.go("xdelivery-home",{value_id:$scope.value_id},{reload:!0})})}
$scope.carts.payment_method='';Xdelivery.paymentScreen($scope.carts).then(function(data){$scope.payout=data;$scope.carts.payment_method=""},function(error){$scope.is_loading=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK","xdelivery"),-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent();$scope.placeOrder=function(){if($scope.carts.payment_method==''){Dialog.alert($translate.instant("Error","xdelivery"),$translate.instant("Please select a payment method!","xdelivery"),$translate.instant("OK","xdelivery"),-1);return!0}
Xdelivery.carts=$scope.carts;Loader.show();Xdelivery.orderSubmit($scope.carts).then(function(data){$state.go("home",{value_id:$scope.value_id},{reload:!0}).then(function(){$state.go("xdelivery-home",{value_id:$scope.value_id},{reload:!0}).then(function(){Loader.hide();$state.go("xdelivery-order-success",{value_id:$scope.value_id,order_id:data.order_id},{reload:!0})})})},function(error){Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK","xdelivery"),-1)})}}).controller('XdeliveryOrderSuccessController',function(Dialog,Loader,Customer,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.order_id=$stateParams.order_id;$scope.is_loading=!1;$scope.payout={};$scope.carts=Xdelivery.carts;Xdelivery.carts={};$scope.loadContent=function(){$scope.is_loading=!0;Xdelivery.findOrderById($scope.order_id).then(function(data){$scope.payout=data;if(data.order.method_type=='ewallet'){Loader.show();$state.go("home",{value_id:$scope.value_id},{reload:!0}).then(function(){$state.go("xdelivery-home",{value_id:$scope.value_id},{reload:!0}).then(function(){Loader.hide();$state.go("xdelivery-ewallet",{value_id:$scope.value_id,order_id:$scope.order_id},{reload:!0})})})}},function(error){$scope.is_loading=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK","xdelivery"),-1)}).then(function(){$scope.is_loading=!1})};$scope.loadContent();$scope.goHome=function(){Loader.show();$state.go("home",{value_id:$scope.value_id},{reload:!0}).then(function(){Loader.hide();$state.go("xdelivery-home",{value_id:$scope.value_id},{reload:!0})})}
$scope.goToOrderDetails=function(){Loader.show();$state.go("home",{value_id:$scope.value_id},{reload:!0}).then(function(){Loader.hide();$state.go("xdelivery-home",{value_id:$scope.value_id},{reload:!0}).then(function(){$state.go("xdelivery-orders",{value_id:$scope.value_id,order_id:$scope.order_id},{reload:!0})})})}});angular.module('starter').controller('XdeliveryOrdersController',function(Dialog,$ionicPopup,Loader,$timeout,$ionicModal,$filter,Customer,$rootScope,SB,$scope,$state,$stateParams,$translate,Xdelivery){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.order_id=$stateParams.order_id;$scope.is_loading=!1;$scope.payout={};$scope.settings=Xdelivery.settings;$scope.loadContent=function(){$scope.is_loading=!0;Xdelivery.findAllOrders().then(function(data){$scope.payout=data},function(error){$scope.is_loading=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK","xdelivery"),-1)}).then(function(){$scope.is_loading=!1});$timeout(function(){if(!Xdelivery.isUndefined($scope.order_id)&&$scope.order_id!=''&&$scope.order_id!=null){$scope.orderDetails($scope.order_id);$scope.order_id=''}},300)};$scope.loadContent();$scope.convertDate=function(date){return $filter('moment_calendar')((new Date(date)).getTime())};$scope.orderDetails=function(order_id){$scope.isLoading=!0;Loader.show();$ionicModal.fromTemplateUrl('features/xdelivery/assets/templates/l1/modal/order_details.html',{scope:$scope,animation:'slide-in-right-left'}).then(function(modal){Xdelivery.findOrderById(order_id).then(function(data){$scope.order_info=data.order;if($scope.order_info.delivery_method=='pickup'){if($scope.settings.enable_to_pickup){if($scope.settings.enable_date_to_pickup){$scope.is_allow_select_date=!0}
if($scope.settings.enable_time_to_pickup){$scope.is_allow_select_time=!0}}}else{if($scope.settings.enable_to_deliver){if($scope.settings.enable_date_to_deliver){$scope.is_allow_select_date=!0}
if($scope.settings.enable_time_to_deliver){$scope.is_allow_select_time=!0}}}},function(error){$scope.isLoading=!1;Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK","xdelivery"),-1)}).then(function(){$scope.isLoading=!1;Loader.hide()});$scope.modalOrderDetails=modal;$scope.modalOrderDetails.show()})};$scope.closeModalOrderDetails=function(){$scope.modalOrderDetails.remove()}
$scope.cancelOrder=function(order_id){$ionicPopup.show({title:$translate.instant('Confirm',"xdelivery"),template:$translate.instant('Are you sure want to Cancel Order?',"xdelivery"),cssClass:'cancel-status',scope:$scope,buttons:[{text:$translate.instant('No',"xdelivery"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('Yes',"xdelivery"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){Loader.show();Xdelivery.cancelOrder(order_id).then(function(data){Dialog.alert($translate.instant("Success","xdelivery"),data.message,$translate.instant("OK","xdelivery"),-1);$scope.loadContent();$scope.closeModalOrderDetails()},function(error){Loader.hide();Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK","xdelivery"),-1)}).then(function(){Loader.hide()})}})}
$scope.reTryPaymentNow=function(order_id){$scope.closeModalOrderDetails();$state.go("xdelivery-ewallet",{value_id:$scope.value_id,order_id:order_id},{reload:!0})}});angular.module('starter').controller('XdeliveryEwalletController',function(Dialog,Loader,Customer,$filter,Modal,$ionicPopup,$ionicScrollDelegate,$timeout,$ionicHistory,$rootScope,SB,Xdelivery,$scope,$state,$stateParams,$translate,Ewallet,$ionicHistory,$ionicSideMenuDelegate){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.order_id=$stateParams.order_id;$scope.is_loading=!1;$scope.loadContent=function(){$scope.cart={};Loader.show();Xdelivery.findOrderById($scope.order_id).then(function(data){$scope.payout=data;$scope.cart.method=='payToModule';$scope.cart.order_id=$scope.order_id;$scope.cart.amount=data.order.total_amount;$scope.cart.currency_code=data.order.currency;$scope.cart.currency_symbol=data.order.currency;$scope.cart.remark=$translate.instant("Order","xdelivery")+"# "+data.order.order_number;$scope.cart.return_state_name='xdelivery-ewallet-return';$scope.cart.return_value_id=$scope.value_id;Ewallet.setPaycart($scope.cart);$ionicHistory.nextViewOptions({disableBack:!0});$ionicSideMenuDelegate.canDragContent(!1);$state.go("ewallet-module-payment",{value_id:data.ewallet_value_id},{reload:!0});Loader.hide()},function(error){Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("Ok","xdelivery"),-1,'xdelivery')}).then(function(){$scope.is_loading=!1})}
$scope.loadContent()}).controller('XdeliveryEwalletReturnController',function(Dialog,Loader,Customer,$filter,Modal,$ionicPopup,$ionicScrollDelegate,$timeout,$ionicHistory,$rootScope,SB,Xdelivery,$scope,$state,$stateParams,$translate,Ewallet,$ionicHistory,$ionicSideMenuDelegate){$scope.value_id=Xdelivery.value_id=$stateParams.value_id;$scope.cart=Ewallet.getPaycart();$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1,disableBack:!0});$ionicSideMenuDelegate.canDragContent(!0);Loader.show();Xdelivery.updatePaymentStatus($scope.cart).then(function(data){Loader.hide();if($scope.cart.status=='success'){Dialog.alert($translate.instant("Error","xdelivery"),$translate.instant("Payment has been successfully","xdelivery"),$translate.instant("OK","xdelivery"),-1,"xdelivery")}
if($scope.cart.status=='failed'){Dialog.alert($translate.instant("Error","xdelivery"),$translate.instant("Payment has been failed","xdelivery"),$translate.instant("OK","xdelivery"),-1,"xdelivery")}
Ewallet.setPaycart({});$state.go("home",{value_id:$scope.value_id},{reload:!0}).then(function(){$state.go("xdelivery-home",{value_id:$scope.value_id},{reload:!0}).then(function(){$state.go("xdelivery-orders",{value_id:$scope.value_id,order_id:$scope.cart.order_id},{reload:!0})})})},function(error){Loader.hide();Dialog.alert($translate.instant("Error","xdelivery"),error.message,$translate.instant("OK","xdelivery"),-1,"xdelivery")})});angular.module('starter').factory('Xdelivery',function(Application,Pages,Customer,$state,$pwaRequest,$ionicPlatform,$session,Dialog,SB,$ionicPopup,$translate){var factory={};factory.value_id=null;factory.settings={};factory.carts={};factory.setValueId=function(valueId){factory.value_id=valueId;return factory};factory.getValueId=function(){return factory.value_id};factory.isUndefined=function(thing){return(typeof thing==="undefined")}
factory.findAll=function(){return $pwaRequest.post('Xdelivery/mobile_view/find-all',{data:{value_id:factory.value_id},cache:!1,refresh:!0})};factory.getCategoryByParentId=function(parent_id,offset=0,refresh){return $pwaRequest.post('xdelivery/mobile_product/get-category-by-parent-id',{data:{value_id:factory.value_id,parent_id:parent_id,offset:offset,},cache:!1,refresh:refresh})};factory.getProductsByCategoryId=function(category_id,offset=0,refresh){return $pwaRequest.post('xdelivery/mobile_product/get-products-by-category-id',{data:{value_id:factory.value_id,category_id:category_id,offset:offset},cache:!1,refresh:refresh})};factory.popularSuggestions=function(){return $pwaRequest.post('xdelivery/mobile_view/popular-suggestions',{data:{value_id:factory.value_id},cache:!1,refresh:!0})};factory.findProductsSearch=function(refresh,offset=0,search=null){return $pwaRequest.post('xdelivery/mobile_product/load-products',{data:{value_id:factory.value_id,offset:offset,search:search},refresh:refresh})};factory.cartProduct=function(){return $pwaRequest.post('xdelivery/mobile_cart/find-all',{data:{value_id:factory.value_id,device_uid:$session.getDeviceUid()},cache:!1,refresh:!0})};factory.findByProductId=function(product_id){return $pwaRequest.post('xdelivery/mobile_product/find-by-product-id',{data:{value_id:factory.value_id,device_uid:$session.getDeviceUid(),product_id:product_id},cache:!1,refresh:!0})};factory.findOptionsValuesById=function(option_id){return $pwaRequest.post('xdelivery/mobile_product/find-options-values-by-id',{data:{value_id:factory.value_id,option_id:option_id},cache:!1,refresh:!0})};factory.saveForLater=function(product_id){return $pwaRequest.post('xdelivery/mobile_cart/save-for-later',{data:{value_id:factory.value_id,device_uid:$session.getDeviceUid(),product_id:product_id},cache:!1,refresh:!0})};factory.addToCart=function(param){param.device_uid=$session.getDeviceUid();return $pwaRequest.post('xdelivery/mobile_cart/add-to-cart',{urlParams:{value_id:factory.value_id},data:param,cache:!1,refresh:!0})};factory.decreaseQuantity=function(product_id,cart_key){return $pwaRequest.post('xdelivery/mobile_cart/decrease-quantity',{data:{value_id:factory.value_id,device_uid:$session.getDeviceUid(),product_id:product_id,cart_key:cart_key},cache:!1,refresh:!0})};factory.increaseQuantity=function(product_id,cart_key){return $pwaRequest.post('xdelivery/mobile_cart/increase-quantity',{data:{value_id:factory.value_id,device_uid:$session.getDeviceUid(),product_id:product_id,cart_key:cart_key},cache:!1,refresh:!0})};factory.saveForLater=function(product_id){return $pwaRequest.post('xdelivery/mobile_cart/save-for-later',{data:{value_id:factory.value_id,device_uid:$session.getDeviceUid(),product_id:product_id},cache:!1,refresh:!0})};factory.syncDeviceAndCustomerCart=function(device_uid){return $pwaRequest.post('xdelivery/mobile_cart/sync-device-customer',{urlParams:{value_id:factory.value_id,device_uid:device_uid,},cache:!1,refresh:!0})};factory.findWishlist=function(offset=0){return $pwaRequest.post('xdelivery/mobile_account/fetch-all-wishlist',{data:{value_id:factory.value_id,device_uid:$session.getDeviceUid(),offset:offset},cache:!1,refresh:!0})};factory.findAddress=function(){return $pwaRequest.post('xdelivery/mobile_account/fetch-all-address',{data:{value_id:factory.value_id,device_uid:$session.getDeviceUid()},cache:!1,refresh:!0})};factory.saveAddress=function(param){return $pwaRequest.post('xdelivery/mobile_account/save-address',{urlParams:{value_id:factory.value_id},data:param,cache:!1,refresh:!0})};factory.deleteAddress=function(address_id){return $pwaRequest.post('xdelivery/mobile_account/delete-address',{urlParams:{value_id:factory.value_id,address_id:address_id},cache:!1,refresh:!0})};factory.checkoutScreen=function(delivery_type){return $pwaRequest.post('xdelivery/mobile_cart/checkout-screen',{urlParams:{value_id:factory.value_id,delivery_type:delivery_type},cache:!1,refresh:!0})};factory.paymentScreen=function(params){var data={delivery_date:params.delivery_date,delivery_time:params.delivery_time,address_id:params.address,delivery_type:params.delivery,};return $pwaRequest.post('xdelivery/mobile_cart/payment-screen',{urlParams:{value_id:factory.value_id},data:data,cache:!1,refresh:!0})};factory.orderSubmit=function(params){return $pwaRequest.post('xdelivery/mobile_order/save',{urlParams:{value_id:factory.value_id},data:params,cache:!1,refresh:!0})};factory.findOrderById=function(order_id){return $pwaRequest.post('xdelivery/mobile_order/find-order-by-id',{urlParams:{value_id:factory.value_id,order_id:order_id},cache:!1,refresh:!0})};factory.findAllOrders=function(order_id){return $pwaRequest.post('xdelivery/mobile_order/find-all-order',{urlParams:{value_id:factory.value_id,},cache:!1,refresh:!0})};factory.updatePaymentStatus=function(params){return $pwaRequest.post('xdelivery/mobile_order/update-payment-status',{urlParams:{value_id:factory.value_id,},data:params,refresh:!0})};factory.cancelOrder=function(order_id){return $pwaRequest.post('xdelivery/mobile_order/cancel',{urlParams:{value_id:factory.value_id,order_id:order_id},refresh:!0})};return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.xdelivery .remove-border{border:0}.xdelivery .button-floating-action{position:fixed!important;top:calc(90vh - 60px)!important;right:2vw!important;border-radius:100px!important;border-width:0!important;padding:5px 12px 5px 12px!important;z-index:999!important;box-shadow:5px 5px 5px #888!important}.xdelivery p.category_name{margin-top:0}.xdelivery p.product_name{margin-top:0;margin-bottom:0}.xdelivery p.product_price{margin-top:0;font-weight:600}.xdelivery .badge-product{top:auto;right:auto}.xdelivery .home-serach-list{margin:0 16px}.xdelivery .home-serach-list input{padding-right:20px!important;height:auto!important;width:auto}.xdelivery .badge-cart{margin-top:-16px}.xdelivery .product-border-bottom{border-bottom:.1px solid!important}.xdelivery .product-border-right{border-right:.1px solid!important}.xdelivery .list_product_name{overflow:initial;white-space:initial}.xdelivery .cart_qty_buttons .col{padding:0}.xdelivery .cart_qty_buttons .item-input{text-align:center;width:100%;padding-top:45%}.xdelivery .cart_footer{padding:0}.xdelivery .cart_footer .button-full{margin-top:0}.xdelivery .xdelivery-cart .item-note{float:left}.xdelivery .button-icon.icon:before{font-size:22px}.xdelivery .xdelivery-product-grid-img{min-height:100px}.xdelivery .product-details-img .full-image{width:70%}.xdelivery .item-multiple-options{padding:0}.xdelivery .radio-multiple-options .item-content{padding-right:0;padding:12px 6px 12px 6px}.xdelivery .radio-multiple-options .radio-icon{padding:0}.xdelivery .product_options{white-space:break-spaces}","xdelivery")