angular.module('starter').factory('Migabot',function(Application,$pwaRequest,$timeout){var factory={userbot:null};factory.onStart=function(){Application.loaded.then(function(){factory.loadBot()})};factory.loadBot=function(){if(typeof Userbot==='undefined'){console.info('[MigaBot] loadBot');factory.fetchSettings().then(function(payload){console.log(payload);if(payload.widgetactive==1){factory.insertScript(payload.settings)}else{console.log("MigaBot Not Active")}})}};factory.insertScript=function(settings){let cssElement=document.createElement('style');cssElement.append('body.platform-cordova {\n'+'    position: static !important;\n'+'}\n');document.body.appendChild(cssElement);settings.poweredBy=!1;settings.onSystemReady=function(){console.info('[MigaBot] onSystemReady')};settings.onMessageButtonClick=function(data){console.log("onMessageButtonClick")
console.log(data)};let botElement=document.createElement('script');botElement.type='text/javascript';botElement.src='https://cdn.userbot.ai/widget-chat/dist/userbot.js';botElement.onload=function(){let appElement=document.createElement('script');appElement.type='text/javascript';appElement.src='https://cdn.userbot.ai/widget-chat/dist/app.js?callback=Userbot&ts='+Date.now();appElement.onload=function(){console.log("onload");factory.userbot=Userbot(settings)};document.body.appendChild(appElement)};document.body.appendChild(botElement)};factory.fetchSettings=function(){return $pwaRequest.get('/migabot/mobile_settings/fetch')};return factory});Features.insertCSS("","migabot")